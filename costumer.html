
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แดชบอร์ดพฤติกรรมผู้บริโภค</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .table-container table {
            min-width: 100%;
        }
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            color: #4b5563;
        }
        .filter-input {
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            width: 100%;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center">แดชบอร์ดพฤติกรรมผู้บริโภค</h1>

        <!-- File Upload Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-4 text-center">อัปโหลดไฟล์ข้อมูล</h2>
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                <input type="file" id="csvFile" accept=".csv" class="w-full md:w-auto text-gray-700">
                <button id="uploadButton" class="w-full md:w-auto bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">
                    อัปโหลดและแสดงข้อมูล
                </button>
            </div>
            <p id="statusMessage" class="mt-4 text-center text-gray-600">กรุณาเลือกไฟล์ CSV เพื่ออัปโหลด</p>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="card">
                <h3 class="text-lg font-medium text-gray-500">จำนวนผู้ใช้งานทั้งหมด</h3>
                <p id="totalUsers" class="mt-2 text-3xl font-extrabold text-indigo-600">0</p>
            </div>
            <div class="card">
                <h3 class="text-lg font-medium text-gray-500">คะแนนความพึงพอใจเฉลี่ย</h3>
                <p id="avgSatisfaction" class="mt-2 text-3xl font-extrabold text-green-600">0</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-2xl font-bold mb-4 text-center">จำนวนผู้ใช้งานตาม Platform</h2>
            <div class="flex justify-center">
                <canvas id="platformChart" class="w-full h-96"></canvas>
            </div>
        </div>

        <!-- Filterable Table -->
        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold mb-4 text-center">ข้อมูลพฤติกรรมผู้บริโภค</h2>
            <div class="mb-4">
                <input type="text" id="filterInput" class="filter-input" placeholder="ค้นหาจาก Location, Education, หรือ Preferred Platform">
            </div>
            <div class="table-container rounded-lg">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th>ID</th>
                            <th>เพศ</th>
                            <th>ระดับรายได้</th>
                            <th>การศึกษา</th>
                            <th>แพลตฟอร์มที่ชอบ</th>
                            <th>คะแนนความพึงพอใจ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // CSV data from the uploaded file is embedded here for a seamless experience
        // ข้อมูล CSV จากไฟล์ที่อัปโหลดถูกฝังไว้ที่นี่เพื่อให้ใช้งานได้ทันที
        const embeddedCsvData = `customer_id,age,gender,income_level,education,location,shopping_frequency,preferred_platform,avg_spending,payment_method,product_category,satisfaction_score,recommendation_likelihood,last_purchase_days
1,28,Female,Medium,Bachelor,Bangkok,Weekly,Shopee,2500,Credit Card,Fashion,4.2,8,5
2,34,Male,High,Master,Chiang Mai,Monthly,Lazada,5800,Bank Transfer,Electronics,3.8,7,12
3,22,Female,Low,High School,Nonthaburi,Daily,Facebook Shop,800,E-Wallet,Beauty,4.5,9,2
4,45,Male,High,Bachelor,Phuket,Weekly,Shopee,3200,Credit Card,Home & Garden,4.0,8,8
5,31,Female,Medium,Master,Bangkok,Bi-weekly,Amazon,4100,Credit Card,Books,4.3,9,4
6,26,Male,Low,Bachelor,Chon Buri,Weekly,Lazada,1800,E-Wallet,Sports,3.9,7,6
7,38,Female,High,Master,Bangkok,Monthly,JD Central,6200,Bank Transfer,Electronics,4.1,8,15
8,29,Male,Medium,Bachelor,Khon Kaen,Weekly,Shopee,2800,E-Wallet,Fashion,4.4,9,3
9,33,Female,Medium,Bachelor,Rayong,Bi-weekly,Lazada,3500,Credit Card,Health,4.0,8,7
10,27,Male,High,Master,Bangkok,Daily,Shopee,1200,E-Wallet,Food,4.6,10,1
11,41,Female,Medium,Bachelor,Nakhon Ratchasima,Monthly,Facebook Shop,2900,Bank Transfer,Home & Garden,3.7,6,18
12,25,Male,Low,High School,Samut Prakan,Weekly,Lazada,1500,E-Wallet,Electronics,4.0,7,9
13,36,Female,High,PhD,Bangkok,Monthly,Shopee,7500,Credit Card,Jewelry,4.8,10,25
14,30,Male,Medium,Bachelor,Pattaya,Bi-weekly,Tiktok Shop,2100,Credit Card,Fashion,4.1,8,11
15,24,Female,Low,High School,Udon Thani,Weekly,Lazada,950,E-Wallet,Beauty,4.5,9,4
16,49,Male,High,Master,Chiang Mai,Monthly,Shopee,4800,Bank Transfer,Books,4.0,7,21
17,23,Female,Medium,Bachelor,Bangkok,Weekly,Amazon,3500,Credit Card,Electronics,4.3,9,3
18,37,Male,Low,High School,Nakhon Pathom,Daily,Lazada,1000,E-Wallet,Sports,3.9,7,1
19,42,Female,High,PhD,Phuket,Monthly,Facebook Shop,6500,Bank Transfer,Home & Garden,4.6,9,28
20,29,Male,Medium,Bachelor,Bangkok,Weekly,Shopee,2800,Credit Card,Fashion,4.2,8,6
21,35,Female,High,Master,Rayong,Bi-weekly,Tiktok Shop,4200,Credit Card,Electronics,4.4,9,10
22,26,Male,Low,High School,Nonthaburi,Weekly,Lazada,1100,E-Wallet,Food,4.1,8,5
23,32,Female,Medium,Bachelor,Samut Prakan,Monthly,Shopee,3100,Bank Transfer,Health,4.0,7,14
24,40,Male,High,Master,Bangkok,Weekly,Amazon,5500,Credit Card,Electronics,4.5,9,9
25,21,Female,Low,High School,Chiang Mai,Daily,Facebook Shop,700,E-Wallet,Beauty,4.3,9,2
26,48,Male,High,PhD,Phuket,Monthly,JD Central,8000,Bank Transfer,Jewelry,4.7,10,30
27,33,Female,Medium,Bachelor,Khon Kaen,Bi-weekly,Shopee,3800,Credit Card,Fashion,4.2,8,7
28,27,Male,Low,High School,Bangkok,Weekly,Lazada,1300,E-Wallet,Books,3.8,6,3
29,39,Female,High,Master,Nakhon Ratchasima,Monthly,Tiktok Shop,6000,Bank Transfer,Electronics,4.1,8,19
30,25,Male,Medium,Bachelor,Pattaya,Weekly,Shopee,2600,Credit Card,Sports,4.0,7,5
31,31,Female,High,PhD,Bangkok,Monthly,Lazada,7000,Bank Transfer,Jewelry,4.6,10,22
32,46,Male,High,Master,Phuket,Weekly,Amazon,4900,Credit Card,Home & Garden,4.4,9,8
33,28,Female,Medium,Bachelor,Chiang Mai,Bi-weekly,Shopee,2400,E-Wallet,Beauty,4.2,8,6
34,35,Male,Low,High School,Nonthaburi,Monthly,Lazada,1700,Bank Transfer,Electronics,3.9,7,13
35,43,Female,High,Master,Bangkok,Weekly,Facebook Shop,5000,Credit Card,Health,4.5,9,10
36,22,Male,Medium,Bachelor,Khon Kaen,Daily,Shopee,1500,E-Wallet,Fashion,4.1,8,2
37,50,Female,High,PhD,Bangkok,Monthly,Amazon,9000,Credit Card,Jewelry,4.9,10,35
38,30,Male,Low,High School,Pattaya,Weekly,Tiktok Shop,1200,E-Wallet,Books,3.8,6,4
39,24,Female,Medium,Bachelor,Udon Thani,Bi-weekly,Shopee,2300,Credit Card,Electronics,4.0,7,9
40,37,Male,High,Master,Bangkok,Monthly,Lazada,5200,Bank Transfer,Electronics,4.2,8,16
41,29,Female,Low,High School,Samut Prakan,Weekly,Facebook Shop,900,E-Wallet,Beauty,4.4,9,3
42,44,Male,High,PhD,Nakhon Ratchasima,Monthly,Shopee,7200,Credit Card,Home & Garden,4.6,9,24
43,32,Female,Medium,Bachelor,Bangkok,Weekly,Lazada,2700,Bank Transfer,Fashion,4.1,8,7
44,26,Male,Medium,Bachelor,Phuket,Bi-weekly,Amazon,3000,Credit Card,Sports,4.0,7,11
45,38,Female,Low,High School,Chiang Mai,Monthly,Shopee,1400,E-Wallet,Food,3.9,7,20
46,25,Male,High,Master,Bangkok,Weekly,JD Central,4800,Bank Transfer,Electronics,4.3,9,5
47,41,Female,Medium,Bachelor,Pattaya,Bi-weekly,Lazada,2900,Credit Card,Health,4.2,8,8
48,30,Male,Medium,Bachelor,Khon Kaen,Monthly,Shopee,3500,E-Wallet,Fashion,4.0,7,15
49,34,Female,High,PhD,Bangkok,Weekly,Tiktok Shop,5500,Credit Card,Electronics,4.5,9,6
50,23,Male,Low,High School,Nonthaburi,Daily,Facebook Shop,850,E-Wallet,Beauty,4.3,8,1`

        document.addEventListener('DOMContentLoaded', () => {
            const uploadButton = document.getElementById('uploadButton');
            const csvFile = document.getElementById('csvFile');
            const statusMessage = document.getElementById('statusMessage');
            const tableBody = document.getElementById('dataTable');
            const filterInput = document.getElementById('filterInput');
            let originalData = [];
            let myChart;
            
            // Initial load from embedded data
            // โหลดข้อมูลเริ่มต้นจากข้อมูลที่ฝังไว้
            try {
                originalData = parseCSV(embeddedCsvData);
                statusMessage.textContent = `ข้อมูลถูกโหลดแล้ว: พบ ${originalData.length} รายการ`;
                updateDashboard(originalData);
                renderTable(originalData);
            } catch (error) {
                console.error('Error parsing embedded CSV:', error);
                statusMessage.textContent = 'เกิดข้อผิดพลาดในการอ่านข้อมูลที่ฝังไว้';
            }

            uploadButton.addEventListener('click', () => {
                const file = csvFile.files[0];
                if (!file) {
                    statusMessage.textContent = 'กรุณาเลือกไฟล์ CSV ก่อน';
                    return;
                }

                statusMessage.textContent = 'กำลังอัปโหลดและประมวลผล...';
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const csvText = e.target.result;
                    try {
                        originalData = parseCSV(csvText);
                        statusMessage.textContent = `อัปโหลดสำเร็จ: พบ ${originalData.length} รายการ`;
                        updateDashboard(originalData);
                        renderTable(originalData);
                    } catch (error) {
                        console.error('Error parsing CSV:', error);
                        statusMessage.textContent = 'เกิดข้อผิดพลาดในการอ่านไฟล์ CSV กรุณาตรวจสอบรูปแบบไฟล์';
                    }
                };
                reader.readAsText(file);
            });

            function parseCSV(csv) {
                const lines = csv.trim().split('\n');
                const headers = lines[0].split(',').map(header => header.trim());
                return lines.slice(1).map(line => {
                    const values = line.split(',');
                    let obj = {};
                    headers.forEach((header, i) => {
                        obj[header] = values[i] ? values[i].trim() : '';
                    });
                    return obj;
                });
            }

            function updateDashboard(data) {
                const totalUsers = data.length;
                const totalSatisfaction = data.reduce((sum, row) => sum + parseFloat(row.satisfaction_score), 0);
                const avgSatisfaction = (totalSatisfaction / totalUsers).toFixed(2);

                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('avgSatisfaction').textContent = isNaN(avgSatisfaction) ? 'N/A' : avgSatisfaction;

                const platformCounts = data.reduce((acc, row) => {
                    const platform = row.preferred_platform;
                    if (platform) {
                        acc[platform] = (acc[platform] || 0) + 1;
                    }
                    return acc;
                }, {});

                const labels = Object.keys(platformCounts);
                const chartData = Object.values(platformCounts);

                // 🎨 ชุดสีสันสดใส (มากกว่า 10 สี)
                const colorPalette = [
                    '#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6',
                    '#ec4899', '#14b8a6', '#f97316', '#84cc16', '#06b6d4',
                    '#d946ef', '#22c55e', '#eab308', '#6366f1', '#fb7185'
                ];

                const backgroundColors = labels.map((_, i) => colorPalette[i % colorPalette.length] + 'CC'); // 80% opacity
                const borderColors = labels.map((_, i) => colorPalette[i % colorPalette.length]);

                if (myChart) {
                    myChart.destroy();
                }

                const ctx = document.getElementById('platformChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'จำนวนผู้ใช้งาน',
                            data: chartData,
                            backgroundColor: backgroundColors,
                            borderColor: borderColors,
                            borderWidth: 2,
                            borderRadius: 8 // มุมโค้งสวยงาม
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            // ตั้งค่าการแสดงผลข้อมูลบนแท่งแผนภูมิ
                            datalabels: {
                                anchor: 'end', // ตำแหน่งข้อความ: ที่ปลายแท่ง
                                align: 'end', // จัดตำแหน่งข้อความ: ที่ปลาย
                                color: '#444', // สีข้อความ
                                font: {
                                    weight: 'bold' // ตัวอักษรหนา
                                },
                                formatter: (value, context) => {
                                    // แสดงค่าที่เป็นตัวเลข
                                    return value;
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }

            function renderTable(data) {
                tableBody.innerHTML = '';
                if (data.length === 0) {
                    const noDataRow = document.createElement('tr');
                    noDataRow.innerHTML = `<td colspan="6" class="text-center py-4">ไม่พบข้อมูล</td>`;
                    tableBody.appendChild(noDataRow);
                    return;
                }
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="whitespace-nowrap">${row.customer_id || '-'}</td>
                        <td class="whitespace-nowrap">${row.gender || '-'}</td>
                        <td class="whitespace-nowrap">${row.income_level || '-'}</td>
                        <td class="whitespace-nowrap">${row.education || '-'}</td>
                        <td class="whitespace-nowrap">${row.preferred_platform || '-'}</td>
                        <td class="whitespace-nowrap">${row.satisfaction_score || '-'}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            filterInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredData = originalData.filter(row =>
                    (row.location && row.location.toLowerCase().includes(query)) ||
                    (row.education && row.education.toLowerCase().includes(query)) ||
                    (row.preferred_platform && row.preferred_platform.toLowerCase().includes(query))
                );
                renderTable(filteredData);
            });
        });
    </script>
</body>
</html>
